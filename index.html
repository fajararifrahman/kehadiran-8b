<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Rekap Kehadiran Kelas 8B</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8;
        }
        .tab-active {
            background-color: #3b82f6;
            color: white;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .tab {
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.3s ease;
        }
        .tab:hover:not(.tab-active) {
            background-color: #dbeafe;
        }
        .attendance-icon {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .attendance-icon:hover {
            transform: scale(1.2);
        }
        .attendance-icon.active {
            transform: scale(1.2);
            filter: drop-shadow(0 0 3px rgba(0,0,0,0.3));
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #9ca3af;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #6b7280;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .btn-success {
            background-color: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            background-color: #059669;
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">Sistem Rekap Kehadiran Kelas 8B</h1>
                <div class="text-right">
                    <span id="current-datetime" class="text-xs font-semibold"></span>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="container mx-auto mt-6 px-4">
            <div class="flex border-b border-gray-300">
                <div class="tab tab-active" id="tab-siswa">Data Siswa</div>
                <div class="tab bg-gray-100 text-gray-700" id="tab-kehadiran">Kehadiran</div>
                <div class="tab bg-gray-100 text-gray-700" id="tab-rekap">Rekap Kehadiran</div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto flex-grow p-4">
            <!-- Data Siswa Page -->
            <div id="page-siswa" class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Input Data Siswa</h2>
                <form id="form-siswa" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">NIS</label>
                        <input type="text" id="nis" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Siswa</label>
                        <input type="text" id="nama" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin</label>
                        <select id="jenis-kelamin" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Pilih Jenis Kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div class="md:col-span-3">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-plus mr-2"></i>Tambah Siswa
                        </button>
                    </div>
                </form>

                <h2 class="text-xl font-semibold mb-4 text-gray-800">Data Siswa</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="py-2 px-4 border-b text-left">No</th>
                                <th class="py-2 px-4 border-b text-left">NIS</th>
                                <th class="py-2 px-4 border-b text-left">Nama Siswa</th>
                                <th class="py-2 px-4 border-b text-left">Jenis Kelamin</th>
                                <th class="py-2 px-4 border-b text-left">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="table-siswa">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Kehadiran Page -->
            <div id="page-kehadiran" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Input Kehadiran</h2>
                <form id="form-kehadiran" class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                            <input type="date" id="tanggal-kehadiran" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <p id="holiday-info" class="text-sm text-red-500 mt-1 hidden">Hari libur sekolah</p>
                        </div>
                        <div class="flex items-end">
                            <button type="button" id="btn-hadir-semua" class="btn-success">
                                <i class="fas fa-check-double mr-2"></i>Hadir Semua
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto mt-4">
                        <table class="min-w-full bg-white border border-gray-300">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="py-2 px-4 border-b text-left">No</th>
                                    <th class="py-2 px-4 border-b text-left">NIS</th>
                                    <th class="py-2 px-4 border-b text-left">Nama Siswa</th>
                                    <th class="py-2 px-4 border-b text-left">Status Kehadiran</th>
                                    <th class="py-2 px-4 border-b text-left">Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="table-kehadiran">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save mr-2"></i>Simpan Kehadiran
                        </button>
                    </div>
                </form>
            </div>

            <!-- Rekap Kehadiran Page -->
            <div id="page-rekap" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Rekap Kehadiran</h2>
                <form id="form-rekap" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Awal</label>
                        <input type="date" id="tanggal-awal" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Akhir</label>
                        <input type="date" id="tanggal-akhir" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-sync-alt mr-2"></i>Generate Rekap
                        </button>
                    </div>
                </form>

                <div id="rekap-actions" class="mb-6 hidden">
                    <div class="flex space-x-4">
                        <button id="btn-export-excel" class="btn-success">
                            <i class="fas fa-file-excel mr-2"></i>Export Excel
                        </button>
                        <button id="btn-export-pdf" class="btn-danger">
                            <i class="fas fa-file-pdf mr-2"></i>Cetak PDF
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="py-2 px-4 border-b text-left">No</th>
                                <th class="py-2 px-4 border-b text-left">NIS</th>
                                <th class="py-2 px-4 border-b text-left">Nama Siswa</th>
                                <th class="py-2 px-4 border-b text-left">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="table-rekap">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="mt-4">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                        <div class="flex items-center">
                            <span class="w-4 h-4 inline-block bg-green-500 rounded-full mr-2"></span>
                            <span>H = Hadir</span>
                        </div>
                        <div class="flex items-center">
                            <span class="w-4 h-4 inline-block bg-yellow-500 rounded-full mr-2"></span>
                            <span>I = Izin</span>
                        </div>
                        <div class="flex items-center">
                            <span class="w-4 h-4 inline-block bg-blue-500 rounded-full mr-2"></span>
                            <span>S = Sakit</span>
                        </div>
                        <div class="flex items-center">
                            <span class="w-4 h-4 inline-block bg-red-500 rounded-full mr-2"></span>
                            <span>A = Alpha</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white p-4 mt-auto">
            <div class="container mx-auto text-center">
                <p>&copy; 2025 Sistem Rekap Kehadiran Kelas 8B. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Modal Detail Kehadiran -->
    <div id="modal-detail" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="modal bg-white rounded-lg shadow-lg w-11/12 md:w-3/4 lg:w-2/3 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold" id="modal-title">Detail Kehadiran Siswa</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="modal-content">
                    <div class="mb-4">
                        <p><strong>NIS:</strong> <span id="detail-nis"></span></p>
                        <p><strong>Nama Siswa:</strong> <span id="detail-nama"></span></p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-green-100 p-3 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Total Hadir</p>
                            <p class="text-2xl font-bold text-green-600" id="total-hadir">0</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Total Izin</p>
                            <p class="text-2xl font-bold text-yellow-600" id="total-izin">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Total Sakit</p>
                            <p class="text-2xl font-bold text-blue-600" id="total-sakit">0</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-lg text-center">
                            <p class="text-sm text-gray-600">Total Alpha</p>
                            <p class="text-2xl font-bold text-red-600" id="total-alpha">0</p>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-300">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="py-2 px-4 border-b text-left">No</th>
                                    <th class="py-2 px-4 border-b text-left">Tanggal</th>
                                    <th class="py-2 px-4 border-b text-left">Status Kehadiran</th>
                                    <th class="py-2 px-4 border-b text-left">Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="table-detail-kehadiran">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="modal bg-white rounded-lg shadow-lg w-11/12 md:w-1/3 max-w-md">
            <div class="p-6">
                <div class="mb-4">
                    <div id="alert-icon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full mb-4"></div>
                    <h3 class="text-lg font-semibold text-center" id="alert-title"></h3>
                    <p class="text-gray-600 text-center mt-2" id="alert-message"></p>
                </div>
                <div class="flex justify-center space-x-4">
                    <button id="alert-cancel" class="btn-secondary hidden">Batal</button>
                    <button id="alert-confirm" class="btn-primary">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data storage
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let attendance = JSON.parse(localStorage.getItem('attendance')) || [];
        
        // DOM Elements
        const tabSiswa = document.getElementById('tab-siswa');
        const tabKehadiran = document.getElementById('tab-kehadiran');
        const tabRekap = document.getElementById('tab-rekap');
        const pageSiswa = document.getElementById('page-siswa');
        const pageKehadiran = document.getElementById('page-kehadiran');
        const pageRekap = document.getElementById('page-rekap');
        const formSiswa = document.getElementById('form-siswa');
        const formKehadiran = document.getElementById('form-kehadiran');
        const formRekap = document.getElementById('form-rekap');
        const tableSiswa = document.getElementById('table-siswa');
        const tableKehadiran = document.getElementById('table-kehadiran');
        const tableRekap = document.getElementById('table-rekap');
        const btnHadirSemua = document.getElementById('btn-hadir-semua');
        const tanggalKehadiran = document.getElementById('tanggal-kehadiran');
        const holidayInfo = document.getElementById('holiday-info');
        const rekapActions = document.getElementById('rekap-actions');
        const btnExportExcel = document.getElementById('btn-export-excel');
        const btnExportPdf = document.getElementById('btn-export-pdf');
        const modalDetail = document.getElementById('modal-detail');
        const closeModal = document.getElementById('close-modal');
        const alertModal = document.getElementById('alert-modal');
        const alertTitle = document.getElementById('alert-title');
        const alertMessage = document.getElementById('alert-message');
        const alertIcon = document.getElementById('alert-icon');
        const alertConfirm = document.getElementById('alert-confirm');
        const alertCancel = document.getElementById('alert-cancel');
        const currentDateTimeElement = document.getElementById('current-datetime');

        // Update date and time every second
        function updateDateTime() {
            const now = new Date();
            
            // Format date and time in the requested format: "Rabu, 19 Juli 2025 05:19:30"
            // without the word "pukul" before the time
            const options = { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                hour12: false
            };
            
            // Get formatted date
            let formattedDate = now.toLocaleDateString('id-ID', options);
            
            // Get time separately without "pukul"
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            // Combine date and time
            currentDateTimeElement.textContent = `${formattedDate} ${hours}:${minutes}:${seconds}`;
        }
        
        // Initial update
        updateDateTime();
        
        // Update every second
        setInterval(updateDateTime, 1000);

        // Tab navigation
        tabSiswa.addEventListener('click', () => switchTab('siswa'));
        tabKehadiran.addEventListener('click', () => switchTab('kehadiran'));
        tabRekap.addEventListener('click', () => switchTab('rekap'));

        function switchTab(tab) {
            // Reset all tabs
            [tabSiswa, tabKehadiran, tabRekap].forEach(t => {
                t.classList.remove('tab-active');
                t.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            // Hide all pages
            [pageSiswa, pageKehadiran, pageRekap].forEach(p => p.classList.add('hidden'));
            
            // Activate selected tab
            if (tab === 'siswa') {
                tabSiswa.classList.add('tab-active');
                tabSiswa.classList.remove('bg-gray-100', 'text-gray-700');
                pageSiswa.classList.remove('hidden');
                renderStudents();
            } else if (tab === 'kehadiran') {
                tabKehadiran.classList.add('tab-active');
                tabKehadiran.classList.remove('bg-gray-100', 'text-gray-700');
                pageKehadiran.classList.remove('hidden');
                renderAttendanceForm();
            } else if (tab === 'rekap') {
                tabRekap.classList.add('tab-active');
                tabRekap.classList.remove('bg-gray-100', 'text-gray-700');
                pageRekap.classList.remove('hidden');
                renderRekapTable();
            }
        }

        // Student Form Submission
        formSiswa.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nis = document.getElementById('nis').value;
            const nama = document.getElementById('nama').value;
            const jenisKelamin = document.getElementById('jenis-kelamin').value;
            
            // Check if NIS already exists
            if (students.some(student => student.nis === nis)) {
                showAlert('error', 'Gagal Menambahkan', 'NIS sudah terdaftar. Gunakan NIS yang berbeda.');
                return;
            }
            
            // Add new student
            students.push({
                nis,
                nama,
                jenisKelamin
            });
            
            // Save to localStorage
            localStorage.setItem('students', JSON.stringify(students));
            
            // Reset form and render updated table
            formSiswa.reset();
            renderStudents();
            
            showAlert('success', 'Berhasil', 'Data siswa berhasil ditambahkan.');
        });

        // Render Students Table
        function renderStudents() {
            tableSiswa.innerHTML = '';
            
            if (students.length === 0) {
                tableSiswa.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-4 text-center text-gray-500">Belum ada data siswa</td>
                    </tr>
                `;
                return;
            }
            
            students.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${index + 1}</td>
                    <td class="py-2 px-4 border-b">${student.nis}</td>
                    <td class="py-2 px-4 border-b">${student.nama}</td>
                    <td class="py-2 px-4 border-b">${student.jenisKelamin}</td>
                    <td class="py-2 px-4 border-b">
                        <button class="btn-danger btn-delete" data-nis="${student.nis}">
                            <i class="fas fa-trash-alt"></i> Hapus
                        </button>
                    </td>
                `;
                tableSiswa.appendChild(row);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nis = this.getAttribute('data-nis');
                    confirmDelete(nis);
                });
            });
        }

        // Delete Student Confirmation
        function confirmDelete(nis) {
            showConfirm(
                'warning',
                'Konfirmasi Hapus',
                'Apakah Anda yakin ingin menghapus data siswa ini?',
                () => {
                    // Find student index
                    const studentIndex = students.findIndex(student => student.nis === nis);
                    if (studentIndex !== -1) {
                        // Remove student
                        students.splice(studentIndex, 1);
                        
                        // Save to localStorage
                        localStorage.setItem('students', JSON.stringify(students));
                        
                        // Update attendance data to remove this student
                        attendance = attendance.filter(record => record.nis !== nis);
                        localStorage.setItem('attendance', JSON.stringify(attendance));
                        
                        // Re-render table
                        renderStudents();
                        
                        showAlert('success', 'Berhasil', 'Data siswa berhasil dihapus.');
                    }
                }
            );
        }

        // Check if date is Sunday or holiday
        tanggalKehadiran.addEventListener('change', function() {
            checkHoliday(this.value);
        });

        function checkHoliday(dateStr) {
            const date = new Date(dateStr);
            const day = date.getDay();
            
            // Check if Sunday (0)
            if (day === 0) {
                holidayInfo.textContent = 'Hari Minggu (Libur Sekolah)';
                holidayInfo.classList.remove('hidden');
                return true;
            }
            
            // List of national holidays (simplified for demo)
            const holidays = [
                '2025-01-01', // Tahun Baru
                '2025-04-18', // Jumat Agung
                '2025-05-01', // Hari Buruh
                '2025-05-26', // Idul Fitri 1
                '2025-05-27', // Idul Fitri 2
                '2025-08-17', // Hari Kemerdekaan
                '2025-12-25'  // Natal
            ];
            
            if (holidays.includes(dateStr)) {
                holidayInfo.textContent = 'Tanggal Merah (Libur Sekolah)';
                holidayInfo.classList.remove('hidden');
                return true;
            }
            
            holidayInfo.classList.add('hidden');
            return false;
        }

        // Render Attendance Form
        function renderAttendanceForm() {
            // Set default date to today if not set
            if (!tanggalKehadiran.value) {
                const today = new Date();
                const formattedDate = today.toISOString().split('T')[0];
                tanggalKehadiran.value = formattedDate;
                checkHoliday(formattedDate);
            }
            
            tableKehadiran.innerHTML = '';
            
            if (students.length === 0) {
                tableKehadiran.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-4 text-center text-gray-500">Belum ada data siswa</td>
                    </tr>
                `;
                return;
            }
            
            // Check if attendance data exists for this date
            const date = tanggalKehadiran.value;
            const existingAttendance = {};
            
            attendance.filter(record => record.tanggal === date).forEach(record => {
                existingAttendance[record.nis] = {
                    status: record.status,
                    keterangan: record.keterangan
                };
            });
            
            students.forEach((student, index) => {
                const row = document.createElement('tr');
                const existing = existingAttendance[student.nis] || {};
                
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${index + 1}</td>
                    <td class="py-2 px-4 border-b">${student.nis}</td>
                    <td class="py-2 px-4 border-b">${student.nama}</td>
                    <td class="py-2 px-4 border-b">
                        <div class="flex space-x-4">
                            <div class="text-center">
                                <div class="attendance-icon ${existing.status === 'H' ? 'active' : ''}" data-status="H" data-nis="${student.nis}">
                                    <i class="fas fa-check-circle text-2xl text-green-500"></i>
                                </div>
                                <span class="text-xs block mt-1">Hadir</span>
                            </div>
                            <div class="text-center">
                                <div class="attendance-icon ${existing.status === 'I' ? 'active' : ''}" data-status="I" data-nis="${student.nis}">
                                    <i class="fas fa-clock text-2xl text-yellow-500"></i>
                                </div>
                                <span class="text-xs block mt-1">Izin</span>
                            </div>
                            <div class="text-center">
                                <div class="attendance-icon ${existing.status === 'S' ? 'active' : ''}" data-status="S" data-nis="${student.nis}">
                                    <i class="fas fa-procedures text-2xl text-blue-500"></i>
                                </div>
                                <span class="text-xs block mt-1">Sakit</span>
                            </div>
                            <div class="text-center">
                                <div class="attendance-icon ${existing.status === 'A' ? 'active' : ''}" data-status="A" data-nis="${student.nis}">
                                    <i class="fas fa-times-circle text-2xl text-red-500"></i>
                                </div>
                                <span class="text-xs block mt-1">Alpha</span>
                            </div>
                        </div>
                    </td>
                    <td class="py-2 px-4 border-b">
                        <input type="text" class="keterangan-input w-full px-3 py-2 border border-gray-300 rounded-md" 
                            data-nis="${student.nis}" value="${existing.keterangan || ''}">
                    </td>
                `;
                tableKehadiran.appendChild(row);
            });
            
            // Add event listeners to attendance icons
            document.querySelectorAll('.attendance-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const nis = this.getAttribute('data-nis');
                    const status = this.getAttribute('data-status');
                    
                    // Remove active class from all icons in the same row
                    const row = this.closest('tr');
                    row.querySelectorAll('.attendance-icon').forEach(i => i.classList.remove('active'));
                    
                    // Add active class to clicked icon
                    this.classList.add('active');
                });
            });
        }

        // Handle "Hadir Semua" button
        btnHadirSemua.addEventListener('click', function() {
            document.querySelectorAll('.attendance-icon').forEach(icon => {
                icon.classList.remove('active');
                if (icon.getAttribute('data-status') === 'H') {
                    icon.classList.add('active');
                }
            });
        });

        // Handle attendance form submission
        formKehadiran.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = tanggalKehadiran.value;
            const isHoliday = checkHoliday(date);
            
            // Collect attendance data
            const newAttendance = [];
            let hasError = false;
            
            students.forEach(student => {
                const row = document.querySelector(`.attendance-icon.active[data-nis="${student.nis}"]`);
                const keterangan = document.querySelector(`.keterangan-input[data-nis="${student.nis}"]`).value;
                
                if (!row && !isHoliday) {
                    hasError = true;
                    return;
                }
                
                const status = isHoliday ? 'L' : row.getAttribute('data-status');
                
                newAttendance.push({
                    nis: student.nis,
                    nama: student.nama,
                    tanggal: date,
                    status: status,
                    keterangan: keterangan
                });
            });
            
            if (hasError) {
                showAlert('error', 'Gagal Menyimpan', 'Pastikan semua siswa memiliki status kehadiran.');
                return;
            }
            
            // Remove existing attendance data for this date
            attendance = attendance.filter(record => record.tanggal !== date);
            
            // Add new attendance data
            attendance = [...attendance, ...newAttendance];
            
            // Save to localStorage
            localStorage.setItem('attendance', JSON.stringify(attendance));
            
            showAlert('success', 'Berhasil', 'Data kehadiran berhasil disimpan.');
        });

        // Rekap Form Submission
        formRekap.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const startDate = document.getElementById('tanggal-awal').value;
            const endDate = document.getElementById('tanggal-akhir').value;
            
            if (!startDate || !endDate) {
                showAlert('error', 'Gagal Generate', 'Pilih tanggal awal dan akhir terlebih dahulu.');
                return;
            }
            
            if (startDate > endDate) {
                showAlert('error', 'Gagal Generate', 'Tanggal awal harus lebih kecil atau sama dengan tanggal akhir.');
                return;
            }
            
            // Show export buttons
            rekapActions.classList.remove('hidden');
            
            // Render rekap table
            renderRekapTable(startDate, endDate);
        });

        // Render Rekap Table
        function renderRekapTable(startDate = null, endDate = null) {
            tableRekap.innerHTML = '';
            
            if (students.length === 0) {
                tableRekap.innerHTML = `
                    <tr>
                        <td colspan="4" class="py-4 text-center text-gray-500">Belum ada data siswa</td>
                    </tr>
                `;
                return;
            }
            
            students.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${index + 1}</td>
                    <td class="py-2 px-4 border-b">${student.nis}</td>
                    <td class="py-2 px-4 border-b">${student.nama}</td>
                    <td class="py-2 px-4 border-b">
                        <div class="flex space-x-2">
                            <button class="btn-primary btn-detail" data-nis="${student.nis}">
                                <i class="fas fa-info-circle"></i>
                                <span class="text-xs block">Detail</span>
                            </button>
                            <button class="btn-danger btn-cetak" data-nis="${student.nis}">
                                <i class="fas fa-print"></i>
                                <span class="text-xs block">Cetak</span>
                            </button>
                        </div>
                    </td>
                `;
                tableRekap.appendChild(row);
            });
            
            // Add event listeners to detail buttons
            document.querySelectorAll('.btn-detail').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nis = this.getAttribute('data-nis');
                    showDetailModal(nis, startDate, endDate);
                });
            });
            
            // Add event listeners to cetak buttons
            document.querySelectorAll('.btn-cetak').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nis = this.getAttribute('data-nis');
                    printIndividualPDF(nis, startDate, endDate);
                });
            });
        }

        // Show Detail Modal
        function showDetailModal(nis, startDate, endDate) {
            const student = students.find(s => s.nis === nis);
            if (!student) return;
            
            document.getElementById('detail-nis').textContent = student.nis;
            document.getElementById('detail-nama').textContent = student.nama;
            
            const tableDetailKehadiran = document.getElementById('table-detail-kehadiran');
            tableDetailKehadiran.innerHTML = '';
            
            // Filter attendance records
            let filteredAttendance = attendance.filter(record => record.nis === nis);
            
            if (startDate && endDate) {
                filteredAttendance = filteredAttendance.filter(record => 
                    record.tanggal >= startDate && record.tanggal <= endDate
                );
            }
            
            // Sort by date
            filteredAttendance.sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
            
            // Count attendance status
            let totalHadir = 0;
            let totalIzin = 0;
            let totalSakit = 0;
            let totalAlpha = 0;
            
            filteredAttendance.forEach(record => {
                if (record.status === 'H') totalHadir++;
                else if (record.status === 'I') totalIzin++;
                else if (record.status === 'S') totalSakit++;
                else if (record.status === 'A') totalAlpha++;
            });
            
            document.getElementById('total-hadir').textContent = totalHadir;
            document.getElementById('total-izin').textContent = totalIzin;
            document.getElementById('total-sakit').textContent = totalSakit;
            document.getElementById('total-alpha').textContent = totalAlpha;
            
            if (filteredAttendance.length === 0) {
                tableDetailKehadiran.innerHTML = `
                    <tr>
                        <td colspan="4" class="py-4 text-center text-gray-500">Belum ada data kehadiran</td>
                    </tr>
                `;
            } else {
                filteredAttendance.forEach((record, index) => {
                    const row = document.createElement('tr');
                    
                    let statusText = '';
                    let statusClass = '';
                    
                    if (record.status === 'H') {
                        statusText = 'Hadir';
                        statusClass = 'text-green-600';
                    } else if (record.status === 'I') {
                        statusText = 'Izin';
                        statusClass = 'text-yellow-600';
                    } else if (record.status === 'S') {
                        statusText = 'Sakit';
                        statusClass = 'text-blue-600';
                    } else if (record.status === 'A') {
                        statusText = 'Alpha';
                        statusClass = 'text-red-600';
                    } else if (record.status === 'L') {
                        statusText = 'Libur';
                        statusClass = 'text-gray-600';
                    }
                    
                    row.innerHTML = `
                        <td class="py-2 px-4 border-b">${index + 1}</td>
                        <td class="py-2 px-4 border-b">${formatDate(record.tanggal)}</td>
                        <td class="py-2 px-4 border-b ${statusClass} font-semibold">${statusText}</td>
                        <td class="py-2 px-4 border-b">${record.keterangan || '-'}</td>
                    `;
                    tableDetailKehadiran.appendChild(row);
                });
            }
            
            modalDetail.classList.remove('hidden');
        }

        // Close Detail Modal
        closeModal.addEventListener('click', function() {
            modalDetail.classList.add('hidden');
        });

        // Export to Excel
        btnExportExcel.addEventListener('click', function() {
            const startDate = document.getElementById('tanggal-awal').value;
            const endDate = document.getElementById('tanggal-akhir').value;
            
            if (!startDate || !endDate) {
                showAlert('error', 'Gagal Export', 'Pilih tanggal awal dan akhir terlebih dahulu.');
                return;
            }
            
            exportToExcel(startDate, endDate);
        });

        function exportToExcel(startDate, endDate) {
            showAlert('info', 'Memproses', 'Sedang menyiapkan file Excel...');
            
            setTimeout(() => {
                try {
                    // Get all dates between start and end
                    const dates = getDatesInRange(startDate, endDate);
                    
                    // Prepare data
                    const data = [];
                    
                    // Header row with dates
                    const headerRow = ['No', 'NIS', 'Nama Siswa'];
                    dates.forEach(date => {
                        headerRow.push(formatDate(date));
                    });
                    headerRow.push('Total H');
                    headerRow.push('Total I');
                    headerRow.push('Total S');
                    headerRow.push('Total A');
                    
                    data.push(headerRow);
                    
                    // Data rows
                    students.forEach((student, index) => {
                        const row = [index + 1, student.nis, student.nama];
                        
                        let totalH = 0;
                        let totalI = 0;
                        let totalS = 0;
                        let totalA = 0;
                        
                        dates.forEach(date => {
                            const record = attendance.find(a => a.nis === student.nis && a.tanggal === date);
                            
                            if (record) {
                                row.push(record.status);
                                
                                if (record.status === 'H') totalH++;
                                else if (record.status === 'I') totalI++;
                                else if (record.status === 'S') totalS++;
                                else if (record.status === 'A') totalA++;
                            } else {
                                row.push('-');
                            }
                        });
                        
                        row.push(totalH);
                        row.push(totalI);
                        row.push(totalS);
                        row.push(totalA);
                        
                        data.push(row);
                    });
                    
                    // Create worksheet
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    // Set column widths
                    const colWidths = [
                        { wch: 5 },  // No
                        { wch: 10 }, // NIS
                        { wch: 25 }, // Nama Siswa
                    ];
                    
                    // Add width for date columns
                    for (let i = 0; i < dates.length; i++) {
                        colWidths.push({ wch: 10 });
                    }
                    
                    // Add width for total columns
                    colWidths.push({ wch: 10 }); // Total H
                    colWidths.push({ wch: 10 }); // Total I
                    colWidths.push({ wch: 10 }); // Total S
                    colWidths.push({ wch: 10 }); // Total A
                    
                    ws['!cols'] = colWidths;
                    
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Rekap Kehadiran");
                    
                    // Generate Excel file
                    const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                    const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    
                    // Save file
                    saveAs(blob, `Rekap_Kehadiran_Kelas_8B_${startDate}_${endDate}.xlsx`);
                    
                    showAlert('success', 'Berhasil', 'File Excel berhasil diunduh.');
                } catch (error) {
                    console.error(error);
                    showAlert('error', 'Gagal', 'Terjadi kesalahan saat mengekspor ke Excel.');
                }
            }, 1000);
        }

        // Export to PDF
        btnExportPdf.addEventListener('click', function() {
            const startDate = document.getElementById('tanggal-awal').value;
            const endDate = document.getElementById('tanggal-akhir').value;
            
            if (!startDate || !endDate) {
                showAlert('error', 'Gagal Cetak', 'Pilih tanggal awal dan akhir terlebih dahulu.');
                return;
            }
            
            exportToPDF(startDate, endDate);
        });

        function exportToPDF(startDate, endDate) {
            showAlert('info', 'Memproses', 'Sedang menyiapkan file PDF...');
            
            setTimeout(() => {
                try {
                    // Get all dates between start and end
                    const dates = getDatesInRange(startDate, endDate);
                    
                    // Create PDF document
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('l', 'mm', 'a4');
                    
                    // Add title
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.text('REKAP KEHADIRAN SISWA KELAS 8B', 150, 15, { align: 'center' });
                    
                    // Add period
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Periode: ${formatDate(startDate)} - ${formatDate(endDate)}`, 150, 22, { align: 'center' });
                    
                    // Prepare data
                    const tableData = [];
                    
                    // Header row with dates
                    const headerRow = ['No', 'NIS', 'Nama Siswa'];
                    dates.forEach(date => {
                        // Use short date format for PDF to save space
                        const shortDate = new Date(date).toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit' });
                        headerRow.push(shortDate);
                    });
                    headerRow.push('H');
                    headerRow.push('I');
                    headerRow.push('S');
                    headerRow.push('A');
                    
                    tableData.push(headerRow);
                    
                    // Data rows
                    students.forEach((student, index) => {
                        const row = [index + 1, student.nis, student.nama];
                        
                        let totalH = 0;
                        let totalI = 0;
                        let totalS = 0;
                        let totalA = 0;
                        
                        dates.forEach(date => {
                            const record = attendance.find(a => a.nis === student.nis && a.tanggal === date);
                            
                            if (record) {
                                row.push(record.status);
                                
                                if (record.status === 'H') totalH++;
                                else if (record.status === 'I') totalI++;
                                else if (record.status === 'S') totalS++;
                                else if (record.status === 'A') totalA++;
                            } else {
                                row.push('-');
                            }
                        });
                        
                        row.push(totalH);
                        row.push(totalI);
                        row.push(totalS);
                        row.push(totalA);
                        
                        tableData.push(row);
                    });
                    
                    // Calculate column widths based on content
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const margin = 10;
                    const availableWidth = pageWidth - (margin * 2);
                    
                    // Set fixed widths for first columns
                    const fixedWidths = {
                        0: 10, // No
                        1: 20, // NIS
                        2: 40, // Nama Siswa
                    };
                    
                    // Calculate total fixed width
                    const totalFixedWidth = Object.values(fixedWidths).reduce((sum, width) => sum + width, 0);
                    
                    // Calculate remaining width for date columns and summary columns
                    const remainingColumns = headerRow.length - Object.keys(fixedWidths).length;
                    const remainingWidth = availableWidth - totalFixedWidth;
                    
                    // Calculate width for each remaining column
                    const dateColumnWidth = remainingWidth / remainingColumns;
                    
                    // Create column styles object
                    const columnStyles = {};
                    
                    // Set fixed column widths
                    Object.entries(fixedWidths).forEach(([col, width]) => {
                        columnStyles[col] = { cellWidth: width };
                    });
                    
                    // Set date column widths
                    for (let i = Object.keys(fixedWidths).length; i < headerRow.length; i++) {
                        columnStyles[i] = { cellWidth: dateColumnWidth };
                    }
                    
                    // Add table
                    doc.autoTable({
                        head: [tableData[0]],
                        body: tableData.slice(1),
                        startY: 30,
                        styles: {
                            fontSize: 8,
                            cellPadding: 1,
                            overflow: 'linebreak',
                            lineWidth: 0.1
                        },
                        headStyles: {
                            fillColor: [59, 130, 246],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        columnStyles: columnStyles,
                        margin: { left: margin, right: margin },
                        didDrawPage: (data) => {
                            // Add page number
                            doc.setFontSize(8);
                            doc.text(`Halaman ${doc.internal.getNumberOfPages()}`, pageWidth - 15, doc.internal.pageSize.getHeight() - 10);
                        }
                    });
                    
                    // Add legend - Changed to vertical format
                    const legendY = doc.lastAutoTable.finalY + 10;
                    doc.setFontSize(10);
                    doc.text('Keterangan:', 14, legendY);
                    doc.text('H = Hadir', 14, legendY + 6);
                    doc.text('I = Izin', 14, legendY + 12);
                    doc.text('S = Sakit', 14, legendY + 18);
                    doc.text('A = Alpha', 14, legendY + 24);
                    
                    // Save PDF
                    doc.save(`Rekap_Kehadiran_Kelas_8B_${startDate}_${endDate}.pdf`);
                    
                    showAlert('success', 'Berhasil', 'File PDF berhasil diunduh.');
                } catch (error) {
                    console.error(error);
                    showAlert('error', 'Gagal', 'Terjadi kesalahan saat mencetak PDF.');
                }
            }, 1000);
        }

        // Print Individual PDF
        function printIndividualPDF(nis, startDate, endDate) {
            const student = students.find(s => s.nis === nis);
            if (!student) return;
            
            showAlert('info', 'Memproses', 'Sedang menyiapkan file PDF...');
            
            setTimeout(() => {
                try {
                    // Filter attendance records
                    let filteredAttendance = attendance.filter(record => record.nis === nis);
                    
                    if (startDate && endDate) {
                        filteredAttendance = filteredAttendance.filter(record => 
                            record.tanggal >= startDate && record.tanggal <= endDate
                        );
                    }
                    
                    // Sort by date
                    filteredAttendance.sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
                    
                    // Count attendance status
                    let totalHadir = 0;
                    let totalIzin = 0;
                    let totalSakit = 0;
                    let totalAlpha = 0;
                    
                    filteredAttendance.forEach(record => {
                        if (record.status === 'H') totalHadir++;
                        else if (record.status === 'I') totalIzin++;
                        else if (record.status === 'S') totalSakit++;
                        else if (record.status === 'A') totalAlpha++;
                    });
                    
                    // Create PDF document
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'mm', 'a4');
                    
                    // Page dimensions
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const margin = 20;
                    
                    // Add title
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.text('REKAP KEHADIRAN', pageWidth / 2, 15, { align: 'center' });
                    
                    // Add student info
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`NIS: ${student.nis}`, margin, 30);
                    doc.text(`Nama Siswa: ${student.nama}`, margin, 37);
                    
                    if (startDate && endDate) {
                        doc.text(`Periode: ${formatDate(startDate)} - ${formatDate(endDate)}`, margin, 44);
                    }
                    
                    // Add summary
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('Ringkasan Kehadiran:', margin, 55);
                    
                    doc.setFont(undefined, 'normal');
                    doc.text(`Total Hadir: ${totalHadir}`, margin + 10, 62);
                    doc.text(`Total Izin: ${totalIzin}`, margin + 10, 69);
                    doc.text(`Total Sakit: ${totalSakit}`, margin + 10, 76);
                    doc.text(`Total Alpha: ${totalAlpha}`, margin + 10, 83);
                    
                    // Prepare table data
                    const tableData = [];
                    tableData.push(['No', 'Tanggal', 'Status Kehadiran', 'Keterangan']);
                    
                    filteredAttendance.forEach((record, index) => {
                        let statusText = '';
                        
                        if (record.status === 'H') statusText = 'Hadir';
                        else if (record.status === 'I') statusText = 'Izin';
                        else if (record.status === 'S') statusText = 'Sakit';
                        else if (record.status === 'A') statusText = 'Alpha';
                        else if (record.status === 'L') statusText = 'Libur';
                        
                        tableData.push([
                            index + 1,
                            formatDate(record.tanggal),
                            statusText,
                            record.keterangan || '-'
                        ]);
                    });
                    
                    // Analyze content to determine optimal column widths
                    const contentWidths = {
                        0: [], // No column
                        1: [], // Tanggal column
                        2: [], // Status column
                        3: []  // Keterangan column
                    };
                    
                    // Add header row lengths
                    tableData[0].forEach((header, index) => {
                        contentWidths[index].push(doc.getStringUnitWidth(header) * 3);
                    });
                    
                    // Add data row content lengths
                    tableData.slice(1).forEach(row => {
                        row.forEach((cell, index) => {
                            contentWidths[index].push(doc.getStringUnitWidth(String(cell)) * 3);
                        });
                    });
                    
                    // Find max width for each column
                    const maxWidths = {};
                    Object.keys(contentWidths).forEach(col => {
                        maxWidths[col] = Math.max(...contentWidths[col]);
                    });
                    
                    // Calculate available width for table
                    const availableWidth = pageWidth - (margin * 2);
                    
                    // Define column widths based on content and available space
                    // Using auto width calculation with minimum widths
                    const columnStyles = {
                        0: { cellWidth: 'auto', minCellWidth: 10 },  // No column
                        1: { cellWidth: 'auto', minCellWidth: 25 },  // Tanggal column
                        2: { cellWidth: 'auto', minCellWidth: 30 },  // Status column
                        3: { cellWidth: 'auto', minCellWidth: 30 }   // Keterangan column
                    };
                    
                    // Add table with auto-fit columns
                    doc.autoTable({
                        head: [tableData[0]],
                        body: tableData.slice(1),
                        startY: 95,
                        styles: {
                            fontSize: 10,
                            overflow: 'linebreak',
                            cellPadding: 2,
                            lineWidth: 0.1
                        },
                        headStyles: {
                            fillColor: [59, 130, 246],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        columnStyles: columnStyles,
                        margin: { left: margin, right: margin },
                        tableWidth: 'auto',
                        didDrawPage: (data) => {
                            // Add page number
                            doc.setFontSize(8);
                            doc.text(`Halaman ${doc.internal.getNumberOfPages()}`, pageWidth - 15, pageHeight - 10);
                        }
                    });
                    
                    // Add legend - Changed to vertical format
                    const legendY = doc.lastAutoTable.finalY + 10;
                    doc.setFontSize(10);
                    doc.text('Keterangan:', margin, legendY);
                    doc.text('H = Hadir', margin, legendY + 6);
                    doc.text('I = Izin', margin, legendY + 12);
                    doc.text('S = Sakit', margin, legendY + 18);
                    doc.text('A = Alpha', margin, legendY + 24);
                    
                    // Save PDF
                    doc.save(`Rekap_Kehadiran_${student.nama}_${student.nis}.pdf`);
                    
                    showAlert('success', 'Berhasil', 'File PDF berhasil diunduh.');
                } catch (error) {
                    console.error(error);
                    showAlert('error', 'Gagal', 'Terjadi kesalahan saat mencetak PDF.');
                }
            }, 1000);
        }

        // Helper Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function getDatesInRange(startDate, endDate) {
            const dates = [];
            let currentDate = new Date(startDate);
            const end = new Date(endDate);
            
            while (currentDate <= end) {
                dates.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }

        // Alert Functions
        function showAlert(type, title, message) {
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            
            // Set icon based on type
            if (type === 'success') {
                alertIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4';
                alertIcon.innerHTML = '<i class="fas fa-check text-green-600 text-xl"></i>';
            } else if (type === 'error') {
                alertIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4';
                alertIcon.innerHTML = '<i class="fas fa-times text-red-600 text-xl"></i>';
            } else if (type === 'warning') {
                alertIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 mb-4';
                alertIcon.innerHTML = '<i class="fas fa-exclamation text-yellow-600 text-xl"></i>';
            } else if (type === 'info') {
                alertIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4';
                alertIcon.innerHTML = '<i class="fas fa-info text-blue-600 text-xl"></i>';
            }
            
            // Hide cancel button for regular alerts
            alertCancel.classList.add('hidden');
            
            // Show modal
            alertModal.classList.remove('hidden');
            
            // Set confirm button action
            alertConfirm.onclick = function() {
                alertModal.classList.add('hidden');
            };
        }

        function showConfirm(type, title, message, onConfirm) {
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            
            // Set icon based on type
            if (type === 'warning') {
                alertIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 mb-4';
                alertIcon.innerHTML = '<i class="fas fa-exclamation text-yellow-600 text-xl"></i>';
            }
            
            // Show cancel button
            alertCancel.classList.remove('hidden');
            
            // Show modal
            alertModal.classList.remove('hidden');
            
            // Set button actions
            alertConfirm.onclick = function() {
                alertModal.classList.add('hidden');
                onConfirm();
            };
            
            alertCancel.onclick = function() {
                alertModal.classList.add('hidden');
            };
        }

        // Initialize the app
        renderStudents();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963f443ae146c649',t:'MTc1MzMxNjU4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
