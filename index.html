<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kehadiran Siswa Kelas 8B</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/file-saver/dist/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .header-gradient {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        .btn-primary {
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .table-container {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .status-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0 auto 4px auto;
        }
        .status-label {
            font-size: 12px;
            text-align: center;
            display: block;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .action-button {
            transition: all 0.2s ease;
        }
        .action-button:hover {
            transform: translateY(-2px);
        }
        .action-button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="header-gradient text-white p-6 shadow-md">
            <div class="container mx-auto">
                <h1 class="text-3xl font-bold">Sistem Kehadiran Siswa Kelas 8B</h1>
                <p class="mt-2 opacity-90">Monitoring kehadiran siswa secara efektif</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto flex-grow p-6">
            <!-- Tabs -->
            <div class="mb-6 bg-white rounded-lg shadow-sm">
                <div class="flex border-b">
                    <button id="tab-siswa" class="tab-btn px-6 py-4 font-medium text-blue-600 border-b-2 border-blue-600">Data Siswa</button>
                    <button id="tab-kehadiran" class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-blue-600">Kehadiran</button>
                    <button id="tab-rekap" class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-blue-600">Rekap Kehadiran</button>
                </div>
            </div>

            <!-- Tab Content: Data Siswa -->
            <div id="content-siswa" class="tab-content active bg-white rounded-lg p-6 shadow-sm">
                <h2 class="text-2xl font-bold mb-6">Data Siswa</h2>
                
                <!-- Form Tambah Siswa -->
                <div class="mb-8 bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4">Tambah Siswa Baru</h3>
                    <form id="form-siswa" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">NIS</label>
                            <input type="text" id="nis" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nama Siswa</label>
                            <input type="text" id="nama" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin</label>
                            <select id="jenis-kelamin" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Pilih Jenis Kelamin</option>
                                <option value="Laki-laki">Laki-laki</option>
                                <option value="Perempuan">Perempuan</option>
                            </select>
                        </div>
                        <div class="md:col-span-3">
                            <button type="submit" class="btn-primary bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Tambah Siswa
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Tabel Siswa -->
                <div class="table-container overflow-x-auto bg-white rounded-lg max-w-4xl mx-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIS</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jenis Kelamin</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tabel-siswa" class="bg-white divide-y divide-gray-200">
                            <!-- Data siswa akan ditampilkan di sini -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab Content: Kehadiran -->
            <div id="content-kehadiran" class="tab-content bg-white rounded-lg p-6 shadow-sm">
                <h2 class="text-2xl font-bold mb-6">Input Kehadiran</h2>
                
                <!-- Form Kehadiran -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                            <input type="date" id="tanggal-kehadiran" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div class="flex items-end">
                            <button id="hadir-semua" class="btn-primary bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                Hadir Semua
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Tabel Kehadiran -->
                <div class="table-container overflow-x-auto bg-white rounded-lg max-w-4xl mx-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIS</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Status Kehadiran</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="tabel-kehadiran" class="bg-white divide-y divide-gray-200">
                            <!-- Data kehadiran akan ditampilkan di sini -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6 text-center">
                    <button id="simpan-kehadiran" class="btn-primary bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Simpan Kehadiran
                    </button>
                </div>
            </div>

            <!-- Tab Content: Rekap Kehadiran -->
            <div id="content-rekap" class="tab-content bg-white rounded-lg p-6 shadow-sm">
                <h2 class="text-2xl font-bold mb-6">Rekap Kehadiran</h2>
                
                <!-- Filter Tanggal -->
                <div class="mb-6 bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4">Filter Periode</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Awal</label>
                            <input type="date" id="tanggal-awal" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Akhir</label>
                            <input type="date" id="tanggal-akhir" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex items-end">
                            <button id="generate-rekap" class="btn-primary bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Generate Rekap
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Tombol Export -->
                <div id="export-buttons" class="mb-6 hidden">
                    <div class="flex space-x-4">
                        <button id="export-excel" class="btn-primary bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Export Excel
                        </button>
                        <button id="export-pdf" class="btn-primary bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                            Cetak PDF
                        </button>
                    </div>
                </div>
                
                <!-- Hasil Rekap -->
                <div id="hasil-rekap" class="hidden">
                    <div class="table-container overflow-x-auto bg-white rounded-lg mb-6 max-w-4xl mx-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIS</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-rekap" class="bg-white divide-y divide-gray-200">
                                <!-- Data rekap akan ditampilkan di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg max-w-4xl mx-auto">
                        <h4 class="font-medium mb-2">Keterangan:</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 bg-green-100 text-green-800 text-center font-medium rounded mr-2">H</span>
                                <span>Hadir</span>
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 bg-yellow-100 text-yellow-800 text-center font-medium rounded mr-2">I</span>
                                <span>Izin</span>
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 bg-blue-100 text-blue-800 text-center font-medium rounded mr-2">S</span>
                                <span>Sakit</span>
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 bg-red-100 text-red-800 text-center font-medium rounded mr-2">A</span>
                                <span>Alpha</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white p-4 mt-auto">
            <div class="container mx-auto text-center">
                <p>Sistem Kehadiran Siswa Kelas 8B &copy; 2025</p>
            </div>
        </footer>
    </div>

    <!-- Modal untuk detail kehadiran -->
    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold" id="modal-title">Detail Kehadiran</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- Notifikasi -->
    <div id="notification" class="fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded shadow-md transition-opacity duration-500 opacity-0 hidden">
        <div class="flex items-center">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span id="notification-message">Notifikasi</span>
        </div>
    </div>

    <script>
        // Data Storage
        let dataSiswa = JSON.parse(localStorage.getItem('dataSiswa')) || [];
        let dataKehadiran = JSON.parse(localStorage.getItem('dataKehadiran')) || [];
        
        // Tab Navigation
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.id.replace('tab-', '');
                
                // Update active tab button
                tabButtons.forEach(btn => {
                    if (btn === button) {
                        btn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
                        btn.classList.remove('text-gray-500');
                    } else {
                        btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                        btn.classList.add('text-gray-500');
                    }
                });
                
                // Show active tab content
                tabContents.forEach(content => {
                    if (content.id === `content-${tabId}`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
                
                // Load data for specific tabs
                if (tabId === 'kehadiran') {
                    loadKehadiranForm();
                } else if (tabId === 'rekap') {
                    document.getElementById('export-buttons').classList.add('hidden');
                    document.getElementById('hasil-rekap').classList.add('hidden');
                }
            });
        });
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            
            // Set pesan
            notificationMessage.textContent = message;
            
            // Set warna berdasarkan tipe
            if (type === 'success') {
                notification.className = 'fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded shadow-md transition-opacity duration-500';
            } else if (type === 'warning') {
                notification.className = 'fixed top-4 right-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded shadow-md transition-opacity duration-500';
            } else if (type === 'error') {
                notification.className = 'fixed top-4 right-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-md transition-opacity duration-500';
            }
            
            // Tampilkan notifikasi
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.remove('opacity-0');
            }, 10);
            
            // Hilangkan notifikasi setelah 3 detik
            setTimeout(() => {
                notification.classList.add('opacity-0');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 500);
            }, 3000);
        }
        
        // Form Tambah Siswa
        document.getElementById('form-siswa').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nis = document.getElementById('nis').value;
            const nama = document.getElementById('nama').value;
            const jenisKelamin = document.getElementById('jenis-kelamin').value;
            
            // Validasi NIS unik
            if (dataSiswa.some(siswa => siswa.nis === nis)) {
                showNotification('NIS sudah terdaftar. Gunakan NIS lain.', 'error');
                return;
            }
            
            // Tambah siswa baru
            dataSiswa.push({
                nis,
                nama,
                jenisKelamin
            });
            
            // Simpan ke localStorage
            localStorage.setItem('dataSiswa', JSON.stringify(dataSiswa));
            
            // Reset form dan refresh tabel
            this.reset();
            loadTabelSiswa();
            
            showNotification('Data siswa berhasil ditambahkan!');
        });
        
        // Load Tabel Siswa
        function loadTabelSiswa() {
            const tabelSiswa = document.getElementById('tabel-siswa');
            tabelSiswa.innerHTML = '';
            
            if (dataSiswa.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="px-4 py-4 text-center text-gray-500">
                        Belum ada data siswa. Silakan tambahkan siswa baru.
                    </td>
                `;
                tabelSiswa.appendChild(row);
                return;
            }
            
            dataSiswa.forEach((siswa, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap">${index + 1}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.nis}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.nama}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.jenisKelamin}</td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <button class="hapus-siswa text-white bg-red-500 hover:bg-red-600 px-3 py-1 rounded-md text-sm action-button" data-nis="${siswa.nis}">
                            Hapus
                        </button>
                    </td>
                `;
                tabelSiswa.appendChild(row);
            });
            
            // Event listener untuk tombol hapus
            document.querySelectorAll('.hapus-siswa').forEach(button => {
                button.addEventListener('click', function() {
                    const nis = this.getAttribute('data-nis');
                    hapusSiswa(nis);
                });
            });
        }
        
        // Hapus Siswa
        function hapusSiswa(nis) {
            const siswa = dataSiswa.find(s => s.nis === nis);
            if (confirm(`Peringatan: Anda akan menghapus data siswa ${siswa.nama} (${siswa.nis}). Semua data kehadiran siswa ini juga akan dihapus. Apakah Anda yakin?`)) {
                dataSiswa = dataSiswa.filter(siswa => siswa.nis !== nis);
                localStorage.setItem('dataSiswa', JSON.stringify(dataSiswa));
                
                // Hapus juga data kehadiran siswa tersebut
                dataKehadiran = dataKehadiran.filter(kehadiran => kehadiran.nis !== nis);
                localStorage.setItem('dataKehadiran', JSON.stringify(dataKehadiran));
                
                loadTabelSiswa();
                showNotification('Data siswa berhasil dihapus!');
            }
        }
        
        // Load Form Kehadiran
        function loadKehadiranForm() {
            const tanggalInput = document.getElementById('tanggal-kehadiran');
            const today = new Date().toISOString().split('T')[0];
            tanggalInput.value = today;
            
            tanggalInput.addEventListener('change', function() {
                loadTabelKehadiran(this.value);
            });
            
            loadTabelKehadiran(today);
        }
        
        // Load Tabel Kehadiran
        function loadTabelKehadiran(tanggal) {
            const tabelKehadiran = document.getElementById('tabel-kehadiran');
            tabelKehadiran.innerHTML = '';
            
            if (dataSiswa.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="px-4 py-4 text-center text-gray-500">
                        Belum ada data siswa. Silakan tambahkan siswa terlebih dahulu.
                    </td>
                `;
                tabelKehadiran.appendChild(row);
                return;
            }
            
            dataSiswa.forEach((siswa, index) => {
                // Cek apakah sudah ada data kehadiran untuk siswa pada tanggal tersebut
                const kehadiran = dataKehadiran.find(k => k.nis === siswa.nis && k.tanggal === tanggal);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap">${index + 1}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.nis}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.nama}</td>
                    <td class="px-4 py-4">
                        <div class="flex justify-center space-x-4">
                            <div class="text-center">
                                <label class="cursor-pointer">
                                    <input type="radio" name="status-${siswa.nis}" value="hadir" class="status-kehadiran hidden" data-nis="${siswa.nis}" ${kehadiran && kehadiran.status === 'hadir' ? 'checked' : ''}>
                                    <div class="status-icon bg-green-100 text-green-800 ${kehadiran && kehadiran.status === 'hadir' ? 'ring-2 ring-green-500' : ''}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                        </svg>
                                    </div>
                                    <span class="status-label">Hadir</span>
                                </label>
                            </div>
                            <div class="text-center">
                                <label class="cursor-pointer">
                                    <input type="radio" name="status-${siswa.nis}" value="izin" class="status-kehadiran hidden" data-nis="${siswa.nis}" ${kehadiran && kehadiran.status === 'izin' ? 'checked' : ''}>
                                    <div class="status-icon bg-yellow-100 text-yellow-800 ${kehadiran && kehadiran.status === 'izin' ? 'ring-2 ring-yellow-500' : ''}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </div>
                                    <span class="status-label">Izin</span>
                                </label>
                            </div>
                            <div class="text-center">
                                <label class="cursor-pointer">
                                    <input type="radio" name="status-${siswa.nis}" value="sakit" class="status-kehadiran hidden" data-nis="${siswa.nis}" ${kehadiran && kehadiran.status === 'sakit' ? 'checked' : ''}>
                                    <div class="status-icon bg-blue-100 text-blue-800 ${kehadiran && kehadiran.status === 'sakit' ? 'ring-2 ring-blue-500' : ''}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <span class="status-label">Sakit</span>
                                </label>
                            </div>
                            <div class="text-center">
                                <label class="cursor-pointer">
                                    <input type="radio" name="status-${siswa.nis}" value="alpha" class="status-kehadiran hidden" data-nis="${siswa.nis}" ${kehadiran && kehadiran.status === 'alpha' ? 'checked' : ''}>
                                    <div class="status-icon bg-red-100 text-red-800 ${kehadiran && kehadiran.status === 'alpha' ? 'ring-2 ring-red-500' : ''}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </div>
                                    <span class="status-label">Alpha</span>
                                </label>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <input type="text" class="keterangan w-full px-3 py-2 border rounded-md" data-nis="${siswa.nis}" value="${kehadiran ? kehadiran.keterangan || '' : ''}">
                    </td>
                `;
                tabelKehadiran.appendChild(row);
            });
            
            // Event listener untuk radio buttons
            document.querySelectorAll('.status-kehadiran').forEach(radio => {
                radio.addEventListener('change', function() {
                    // Hapus ring dari semua icon dalam grup yang sama
                    const name = this.getAttribute('name');
                    document.querySelectorAll(`input[name="${name}"]`).forEach(input => {
                        const icon = input.nextElementSibling;
                        if (input.checked) {
                            icon.classList.add('ring-2');
                            if (input.value === 'hadir') icon.classList.add('ring-green-500');
                            if (input.value === 'izin') icon.classList.add('ring-yellow-500');
                            if (input.value === 'sakit') icon.classList.add('ring-blue-500');
                            if (input.value === 'alpha') icon.classList.add('ring-red-500');
                        } else {
                            icon.classList.remove('ring-2', 'ring-green-500', 'ring-yellow-500', 'ring-blue-500', 'ring-red-500');
                        }
                    });
                });
            });
        }
        
        // Fungsi untuk menandai semua siswa hadir
        document.getElementById('hadir-semua').addEventListener('click', function() {
            const radioButtons = document.querySelectorAll('input[value="hadir"]');
            
            radioButtons.forEach(radio => {
                radio.checked = true;
                // Tambahkan ring ke icon
                const icon = radio.nextElementSibling;
                icon.classList.add('ring-2', 'ring-green-500');
                
                // Hapus ring dari icon lain dalam grup yang sama
                const name = radio.getAttribute('name');
                document.querySelectorAll(`input[name="${name}"]:not([value="hadir"])`).forEach(input => {
                    const otherIcon = input.nextElementSibling;
                    otherIcon.classList.remove('ring-2', 'ring-yellow-500', 'ring-blue-500', 'ring-red-500');
                });
            });
            
            showNotification('Semua siswa ditandai hadir!');
        });
        
        // Simpan Kehadiran
        document.getElementById('simpan-kehadiran').addEventListener('click', function() {
            const tanggal = document.getElementById('tanggal-kehadiran').value;
            const keteranganElements = document.querySelectorAll('.keterangan');
            
            if (!tanggal) {
                showNotification('Pilih tanggal terlebih dahulu!', 'error');
                return;
            }
            
            // Hapus data kehadiran yang sudah ada pada tanggal tersebut
            dataKehadiran = dataKehadiran.filter(k => k.tanggal !== tanggal);
            
            // Tambahkan data kehadiran baru
            dataSiswa.forEach(siswa => {
                const checkedRadio = document.querySelector(`input[name="status-${siswa.nis}"]:checked`);
                const keteranganElement = document.querySelector(`.keterangan[data-nis="${siswa.nis}"]`);
                
                if (checkedRadio) {
                    const status = checkedRadio.value;
                    const keterangan = keteranganElement ? keteranganElement.value : '';
                    
                    dataKehadiran.push({
                        tanggal,
                        nis: siswa.nis,
                        status,
                        keterangan
                    });
                } else {
                    // Default ke alpha jika tidak ada yang dipilih
                    dataKehadiran.push({
                        tanggal,
                        nis: siswa.nis,
                        status: 'alpha',
                        keterangan: keteranganElement ? keteranganElement.value : ''
                    });
                }
            });
            
            // Simpan ke localStorage
            localStorage.setItem('dataKehadiran', JSON.stringify(dataKehadiran));
            
            showNotification('Data kehadiran berhasil disimpan!');
        });
        
        // Generate Rekap
        document.getElementById('generate-rekap').addEventListener('click', function() {
            const tanggalAwal = document.getElementById('tanggal-awal').value;
            const tanggalAkhir = document.getElementById('tanggal-akhir').value;
            
            if (!tanggalAwal || !tanggalAkhir) {
                showNotification('Pilih tanggal awal dan tanggal akhir terlebih dahulu!', 'error');
                return;
            }
            
            if (new Date(tanggalAwal) > new Date(tanggalAkhir)) {
                showNotification('Tanggal awal tidak boleh lebih besar dari tanggal akhir!', 'error');
                return;
            }
            
            generateRekap(tanggalAwal, tanggalAkhir);
            document.getElementById('export-buttons').classList.remove('hidden');
            document.getElementById('hasil-rekap').classList.remove('hidden');
            
            showNotification('Rekap kehadiran berhasil dibuat!');
        });
        
        // Generate Rekap Kehadiran
        function generateRekap(tanggalAwal, tanggalAkhir) {
            const tabelRekap = document.getElementById('tabel-rekap');
            tabelRekap.innerHTML = '';
            
            if (dataSiswa.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="px-4 py-4 text-center text-gray-500">
                        Belum ada data siswa.
                    </td>
                `;
                tabelRekap.appendChild(row);
                return;
            }
            
            // Dapatkan semua tanggal dalam rentang
            const tanggalList = getTanggalRange(tanggalAwal, tanggalAkhir);
            
            dataSiswa.forEach((siswa, index) => {
                const row = document.createElement('tr');
                
                // Hitung total kehadiran
                let totalHadir = 0;
                let totalIzin = 0;
                let totalSakit = 0;
                let totalAlpha = 0;
                
                // Data kehadiran per tanggal
                const kehadiranData = [];
                
                tanggalList.forEach(tanggal => {
                    const kehadiran = dataKehadiran.find(k => k.nis === siswa.nis && k.tanggal === tanggal);
                    let status = 'Alpha';
                    let statusCode = 'A';
                    let keterangan = '';
                    
                    if (kehadiran) {
                        status = kehadiran.status.charAt(0).toUpperCase() + kehadiran.status.slice(1);
                        keterangan = kehadiran.keterangan || '';
                        
                        if (kehadiran.status === 'hadir') {
                            statusCode = 'H';
                            totalHadir++;
                        } else if (kehadiran.status === 'izin') {
                            statusCode = 'I';
                            totalIzin++;
                        } else if (kehadiran.status === 'sakit') {
                            statusCode = 'S';
                            totalSakit++;
                        } else if (kehadiran.status === 'alpha') {
                            statusCode = 'A';
                            totalAlpha++;
                        }
                    } else {
                        totalAlpha++;
                    }
                    
                    const formattedTanggal = new Date(tanggal).toLocaleDateString('id-ID', {
                        day: '2-digit',
                        month: 'long',
                        year: 'numeric'
                    });
                    
                    kehadiranData.push({
                        tanggal: formattedTanggal,
                        rawTanggal: tanggal,
                        status: status,
                        statusCode: statusCode,
                        keterangan: keterangan
                    });
                });
                
                // Simpan data untuk modal
                const detailData = {
                    nama: siswa.nama,
                    nis: siswa.nis,
                    totalHadir,
                    totalIzin,
                    totalSakit,
                    totalAlpha,
                    kehadiranData
                };
                
                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap">${index + 1}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.nis}</td>
                    <td class="px-4 py-4 whitespace-nowrap">${siswa.nama}</td>
                    <td class="px-4 py-4 text-center">
                        <div class="flex justify-center space-x-4">
                            <div class="flex flex-col items-center">
                                <button class="detail-btn bg-blue-100 text-blue-800 hover:bg-blue-200 p-2 rounded-full action-button" data-siswa='${JSON.stringify(detailData)}'>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </button>
                                <span class="text-xs text-gray-500 mt-1">Detail</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <button class="cetak-btn bg-red-100 text-red-800 hover:bg-red-200 p-2 rounded-full action-button" data-siswa='${JSON.stringify(detailData)}'>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                                    </svg>
                                </button>
                                <span class="text-xs text-gray-500 mt-1">Cetak</span>
                            </div>
                        </div>
                    </td>
                `;
                tabelRekap.appendChild(row);
            });
            
            // Event listener untuk tombol detail
            document.querySelectorAll('.detail-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const data = JSON.parse(this.getAttribute('data-siswa'));
                    showDetailModal(data);
                });
            });
            
            // Event listener untuk tombol cetak
            document.querySelectorAll('.cetak-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const data = JSON.parse(this.getAttribute('data-siswa'));
                    if (confirm(`Anda akan mencetak rekap kehadiran untuk siswa ${data.nama}. Lanjutkan?`)) {
                        cetakRekapSiswa(data);
                        showNotification(`Rekap kehadiran ${data.nama} berhasil dicetak!`);
                    }
                });
            });
        }
        
        // Tampilkan modal detail
        function showDetailModal(data) {
            const modal = document.getElementById('detail-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            
            modalTitle.textContent = `Detail Kehadiran: ${data.nama} (${data.nis})`;
            
            let contentHTML = `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-700">${data.totalHadir}</div>
                        <div class="text-sm text-green-600">Hadir</div>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-700">${data.totalIzin}</div>
                        <div class="text-sm text-yellow-600">Izin</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-700">${data.totalSakit}</div>
                        <div class="text-sm text-blue-600">Sakit</div>
                    </div>
                    <div class="bg-red-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-700">${data.totalAlpha}</div>
                        <div class="text-sm text-red-600">Alpha</div>
                    </div>
                </div>
                
                <div class="overflow-y-auto max-h-96">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            data.kehadiranData.forEach(item => {
                let statusClass = '';
                if (item.statusCode === 'H') statusClass = 'bg-green-100 text-green-800';
                else if (item.statusCode === 'I') statusClass = 'bg-yellow-100 text-yellow-800';
                else if (item.statusCode === 'S') statusClass = 'bg-blue-100 text-blue-800';
                else if (item.statusCode === 'A') statusClass = 'bg-red-100 text-red-800';
                
                contentHTML += `
                    <tr>
                        <td class="px-4 py-3">${item.tanggal}</td>
                        <td class="px-4 py-3">
                            <span class="inline-block px-2 py-1 rounded ${statusClass}">
                                ${item.status}
                            </span>
                        </td>
                        <td class="px-4 py-3">${item.keterangan || '-'}</td>
                    </tr>
                `;
            });
            
            contentHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            modalContent.innerHTML = contentHTML;
            modal.classList.remove('hidden');
            
            // Event listener untuk tombol tutup
            document.getElementById('close-modal').addEventListener('click', function() {
                modal.classList.add('hidden');
            });
            
            // Tutup modal jika klik di luar modal
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        }
        
        // Export Excel
        document.getElementById('export-excel').addEventListener('click', function() {
            const tanggalAwal = document.getElementById('tanggal-awal').value;
            const tanggalAkhir = document.getElementById('tanggal-akhir').value;
            
            if (!tanggalAwal || !tanggalAkhir) {
                showNotification('Pilih tanggal awal dan tanggal akhir terlebih dahulu!', 'error');
                return;
            }
            
            if (confirm('Anda akan mengexport data kehadiran ke Excel. Lanjutkan?')) {
                exportToExcel(tanggalAwal, tanggalAkhir);
                showNotification('Data berhasil diexport ke Excel!');
            }
        });
        
        // Export PDF
        document.getElementById('export-pdf').addEventListener('click', function() {
            const tanggalAwal = document.getElementById('tanggal-awal').value;
            const tanggalAkhir = document.getElementById('tanggal-akhir').value;
            
            if (!tanggalAwal || !tanggalAkhir) {
                showNotification('Pilih tanggal awal dan tanggal akhir terlebih dahulu!', 'error');
                return;
            }
            
            if (confirm('Anda akan mencetak data kehadiran ke PDF. Lanjutkan?')) {
                exportToPDF(tanggalAwal, tanggalAkhir);
                showNotification('Data berhasil dicetak ke PDF!');
            }
        });
        
        // Cetak Rekap Siswa Individual
        function cetakRekapSiswa(data) {
            // Buat PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // Tambahkan judul dengan huruf besar
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('REKAP KEHADIRAN SISWA KELAS 8B', doc.internal.pageSize.getWidth() / 2, 20, { align: 'center' });
            
            // Tambahkan info siswa dengan desain yang lebih menarik
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            
            // Tambahkan kotak untuk info siswa
            doc.setDrawColor(59, 130, 246); // Warna biru
            doc.setFillColor(240, 249, 255); // Warna biru muda
            doc.roundedRect(14, 30, doc.internal.pageSize.getWidth() - 28, 20, 3, 3, 'FD');
            
            doc.text(`NIS: ${data.nis}`, 20, 40);
            doc.text(`Nama Siswa: ${data.nama}`, 20, 45);
            
            // Tambahkan ringkasan kehadiran dengan desain yang menarik
            const summaryY = 60;
            const summaryWidth = (doc.internal.pageSize.getWidth() - 28) / 4;
            
            // Hadir
            doc.setFillColor(236, 253, 245); // Warna hijau muda
            doc.setDrawColor(16, 185, 129); // Warna hijau
            doc.roundedRect(14, summaryY, summaryWidth, 20, 2, 2, 'FD');
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(16, 185, 129);
            doc.text(`${data.totalHadir}`, 14 + summaryWidth/2, summaryY + 10, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.text('Hadir', 14 + summaryWidth/2, summaryY + 16, { align: 'center' });
            
            // Izin
            doc.setFillColor(254, 252, 232); // Warna kuning muda
            doc.setDrawColor(202, 138, 4); // Warna kuning
            doc.roundedRect(14 + summaryWidth, summaryY, summaryWidth, 20, 2, 2, 'FD');
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(202, 138, 4);
            doc.text(`${data.totalIzin}`, 14 + summaryWidth*1.5, summaryY + 10, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.text('Izin', 14 + summaryWidth*1.5, summaryY + 16, { align: 'center' });
            
            // Sakit
            doc.setFillColor(239, 246, 255); // Warna biru muda
            doc.setDrawColor(37, 99, 235); // Warna biru
            doc.roundedRect(14 + summaryWidth*2, summaryY, summaryWidth, 20, 2, 2, 'FD');
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(37, 99, 235);
            doc.text(`${data.totalSakit}`, 14 + summaryWidth*2.5, summaryY + 10, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.text('Sakit', 14 + summaryWidth*2.5, summaryY + 16, { align: 'center' });
            
            // Alpha
            doc.setFillColor(254, 242, 242); // Warna merah muda
            doc.setDrawColor(220, 38, 38); // Warna merah
            doc.roundedRect(14 + summaryWidth*3, summaryY, summaryWidth, 20, 2, 2, 'FD');
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(220, 38, 38);
            doc.text(`${data.totalAlpha}`, 14 + summaryWidth*3.5, summaryY + 10, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.text('Alpha', 14 + summaryWidth*3.5, summaryY + 16, { align: 'center' });
            
            // Reset warna teks
            doc.setTextColor(0, 0, 0);
            
            // Buat header untuk tabel
            const header = [['No', 'Tanggal', 'Status Kehadiran', 'Keterangan']];
            
            // Buat data untuk tabel
            const tableData = data.kehadiranData.map((item, index) => [
                index + 1,
                item.tanggal,
                item.status,
                item.keterangan || '-'
            ]);
            
            // Tambahkan tabel dengan desain yang lebih menarik
            doc.autoTable({
                head: header,
                body: tableData,
                startY: summaryY + 30,
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                headStyles: {
                    fillColor: [59, 130, 246],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [240, 244, 248]
                },
                columnStyles: {
                    0: { cellWidth: 15 },
                    1: { cellWidth: 50 },
                    2: { cellWidth: 40 },
                    3: { cellWidth: 'auto' }
                },
                didDrawCell: function(data) {
                    // Tambahkan warna pada sel status
                    if (data.section === 'body' && data.column.index === 2) {
                        const status = data.cell.raw;
                        if (status === 'Hadir') {
                            doc.setFillColor(236, 253, 245);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(16, 185, 129);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        } else if (status === 'Izin') {
                            doc.setFillColor(254, 252, 232);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(202, 138, 4);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        } else if (status === 'Sakit') {
                            doc.setFillColor(239, 246, 255);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(37, 99, 235);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        } else if (status === 'Alpha') {
                            doc.setFillColor(254, 242, 242);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(220, 38, 38);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        }
                    }
                }
            });
            
            // Reset warna teks
            doc.setTextColor(0, 0, 0);
            
            // Tambahkan footer
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'italic');
            doc.text('* Dokumen ini dicetak secara otomatis oleh Sistem Kehadiran Siswa Kelas 8B', doc.internal.pageSize.getWidth() / 2, finalY, { align: 'center' });
            
            // Simpan file
            const fileName = `Rekap_Kehadiran_${data.nama.replace(/\s+/g, '_')}_${data.nis}.pdf`;
            doc.save(fileName);
        }
        
        // Export to Excel Function
        function exportToExcel(tanggalAwal, tanggalAkhir) {
            // Dapatkan semua tanggal dalam rentang
            const tanggalList = getTanggalRange(tanggalAwal, tanggalAkhir);
            
            // Format tanggal untuk header
            const formattedTanggalList = tanggalList.map(tanggal => {
                return new Date(tanggal).toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: '2-digit'
                });
            });
            
            // Buat header untuk Excel
            const header = ['No', 'NIS', 'Nama Siswa'];
            
            // Tambahkan tanggal ke header
            formattedTanggalList.forEach(tanggal => {
                header.push(tanggal);
            });
            
            // Tambahkan kolom total
            header.push('Total H', 'Total I', 'Total S', 'Total A');
            
            // Buat data untuk Excel
            const data = [header];
            
            dataSiswa.forEach((siswa, index) => {
                const row = [index + 1, siswa.nis, siswa.nama];
                
                // Hitung total kehadiran
                let totalHadir = 0;
                let totalIzin = 0;
                let totalSakit = 0;
                let totalAlpha = 0;
                
                // Tambahkan status kehadiran per tanggal
                tanggalList.forEach(tanggal => {
                    const kehadiran = dataKehadiran.find(k => k.nis === siswa.nis && k.tanggal === tanggal);
                    let status = 'A'; // Default Alpha
                    
                    if (kehadiran) {
                        if (kehadiran.status === 'hadir') {
                            status = 'H';
                            totalHadir++;
                        } else if (kehadiran.status === 'izin') {
                            status = 'I';
                            totalIzin++;
                        } else if (kehadiran.status === 'sakit') {
                            status = 'S';
                            totalSakit++;
                        } else if (kehadiran.status === 'alpha') {
                            status = 'A';
                            totalAlpha++;
                        }
                    } else {
                        totalAlpha++;
                    }
                    
                    row.push(status);
                });
                
                // Tambahkan total
                row.push(totalHadir, totalIzin, totalSakit, totalAlpha);
                
                data.push(row);
            });
            
            // Buat workbook dan worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            
            // Tambahkan judul dengan huruf besar
            XLSX.utils.sheet_add_aoa(ws, [['REKAP KEHADIRAN SISWA KELAS 8B']], { origin: 'A1' });
            
            // Merge cells untuk judul
            if(!ws['!merges']) ws['!merges'] = [];
            ws['!merges'].push({ s: { r: 0, c: 0 }, e: { r: 0, c: header.length - 1 } });
            
            // Tambahkan keterangan
            const lastRow = data.length + 2;
            XLSX.utils.sheet_add_aoa(ws, [
                ['Keterangan:'],
                ['H = Hadir'],
                ['I = Izin'],
                ['S = Sakit'],
                ['A = Alpha']
            ], { origin: `A${lastRow}` });
            
            // Styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style untuk judul
            const titleAddress = 'A1';
            ws[titleAddress] = { 
                v: 'REKAP KEHADIRAN SISWA KELAS 8B',
                t: 's',
                s: { 
                    font: { bold: true, sz: 16 }, 
                    alignment: { horizontal: 'center', vertical: 'center' } 
                }
            };
            
            // Style untuk header
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_col(C) + '2'; // Header row
                if (!ws[address]) continue;
                ws[address].s = { 
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "3B82F6" } },
                    alignment: { horizontal: 'center', vertical: 'center' }
                };
            }
            
            // Style untuk data
            for (let R = 2; R <= range.e.r; ++R) {
                for (let C = 0; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    // Style untuk kolom status (tanggal)
                    if (C >= 3 && C < header.length - 4) {
                        const status = ws[address].v;
                        if (status === 'H') {
                            ws[address].s = { 
                                font: { color: { rgb: "10B981" } },
                                fill: { fgColor: { rgb: "ECFDF5" } },
                                alignment: { horizontal: 'center' }
                            };
                        } else if (status === 'I') {
                            ws[address].s = { 
                                font: { color: { rgb: "CA8A04" } },
                                fill: { fgColor: { rgb: "FEFCE8" } },
                                alignment: { horizontal: 'center' }
                            };
                        } else if (status === 'S') {
                            ws[address].s = { 
                                font: { color: { rgb: "2563EB" } },
                                fill: { fgColor: { rgb: "EFF6FF" } },
                                alignment: { horizontal: 'center' }
                            };
                        } else if (status === 'A') {
                            ws[address].s = { 
                                font: { color: { rgb: "DC2626" } },
                                fill: { fgColor: { rgb: "FEF2F2" } },
                                alignment: { horizontal: 'center' }
                            };
                        }
                    }
                    
                    // Style untuk kolom total
                    if (C >= header.length - 4) {
                        ws[address].s = { 
                            font: { bold: true },
                            alignment: { horizontal: 'center' }
                        };
                    }
                }
            }
            
            XLSX.utils.book_append_sheet(wb, ws, 'Rekap Kehadiran');
            
            // Konversi ke binary string
            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
            
            // Fungsi untuk mengkonversi string ke ArrayBuffer
            function s2ab(s) {
                const buf = new ArrayBuffer(s.length);
                const view = new Uint8Array(buf);
                for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }
            
            // Simpan file
            const fileName = `Rekap_Kehadiran_8B_${tanggalAwal}_${tanggalAkhir}.xlsx`;
            saveAs(new Blob([s2ab(wbout)], { type: 'application/octet-stream' }), fileName);
        }
        
        // Export to PDF Function
        function exportToPDF(tanggalAwal, tanggalAkhir) {
            // Dapatkan semua tanggal dalam rentang
            const tanggalList = getTanggalRange(tanggalAwal, tanggalAkhir);
            
            // Format tanggal untuk judul
            const formattedTanggalAwal = new Date(tanggalAwal).toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            
            const formattedTanggalAkhir = new Date(tanggalAkhir).toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            
            // Buat PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            
            // Tambahkan judul dengan huruf besar
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('REKAP KEHADIRAN SISWA KELAS 8B', doc.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
            
            // Tambahkan periode dengan desain yang lebih menarik
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            
            // Tambahkan kotak untuk periode
            doc.setDrawColor(59, 130, 246); // Warna biru
            doc.setFillColor(240, 249, 255); // Warna biru muda
            doc.roundedRect(doc.internal.pageSize.getWidth() / 2 - 50, 20, 100, 10, 2, 2, 'FD');
            doc.text(`Periode: ${formattedTanggalAwal} - ${formattedTanggalAkhir}`, doc.internal.pageSize.getWidth() / 2, 26, { align: 'center' });
            
            // Buat header untuk tabel
            const header = [['No', 'NIS', 'Nama Siswa']];
            
            // Tambahkan tanggal ke header
            tanggalList.forEach(tanggal => {
                const formattedTanggal = new Date(tanggal).toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: '2-digit'
                });
                header[0].push(formattedTanggal);
            });
            
            // Tambahkan kolom total
            header[0].push('Total H', 'Total I', 'Total S', 'Total A');
            
            // Buat data untuk tabel
            const tableData = [];
            
            dataSiswa.forEach((siswa, index) => {
                const row = [index + 1, siswa.nis, siswa.nama];
                
                // Hitung total kehadiran
                let totalHadir = 0;
                let totalIzin = 0;
                let totalSakit = 0;
                let totalAlpha = 0;
                
                // Tambahkan status kehadiran per tanggal
                tanggalList.forEach(tanggal => {
                    const kehadiran = dataKehadiran.find(k => k.nis === siswa.nis && k.tanggal === tanggal);
                    let status = 'A'; // Default Alpha
                    
                    if (kehadiran) {
                        if (kehadiran.status === 'hadir') {
                            status = 'H';
                            totalHadir++;
                        } else if (kehadiran.status === 'izin') {
                            status = 'I';
                            totalIzin++;
                        } else if (kehadiran.status === 'sakit') {
                            status = 'S';
                            totalSakit++;
                        } else if (kehadiran.status === 'alpha') {
                            status = 'A';
                            totalAlpha++;
                        }
                    } else {
                        totalAlpha++;
                    }
                    
                    row.push(status);
                });
                
                // Tambahkan total
                row.push(totalHadir, totalIzin, totalSakit, totalAlpha);
                
                tableData.push(row);
            });
            
            // Tambahkan tabel dengan desain yang lebih menarik
            doc.autoTable({
                head: header,
                body: tableData,
                startY: 35,
                styles: {
                    fontSize: 8,
                    cellPadding: 2
                },
                headStyles: {
                    fillColor: [59, 130, 246],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [240, 244, 248]
                },
                didDrawCell: function(data) {
                    // Tambahkan warna pada sel status
                    if (data.section === 'body' && data.column.index >= 3 && data.column.index < header[0].length - 4) {
                        const status = data.cell.raw;
                        if (status === 'H') {
                            doc.setFillColor(236, 253, 245);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(16, 185, 129);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        } else if (status === 'I') {
                            doc.setFillColor(254, 252, 232);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(202, 138, 4);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        } else if (status === 'S') {
                            doc.setFillColor(239, 246, 255);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(37, 99, 235);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        } else if (status === 'A') {
                            doc.setFillColor(254, 242, 242);
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(220, 38, 38);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2, { align: 'center', baseline: 'middle' });
                            return false; // Prevent default text rendering
                        }
                    }
                    
                    // Tambahkan warna pada sel total
                    if (data.section === 'body' && data.column.index >= header[0].length - 4) {
                        doc.setFont('helvetica', 'bold');
                    }
                }
            });
            
            // Reset warna teks
            doc.setTextColor(0, 0, 0);
            
            // Tambahkan keterangan dengan desain yang lebih menarik
            const finalY = doc.lastAutoTable.finalY + 10;
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('Keterangan:', 14, finalY);
            
            // Kotak keterangan
            const legendY = finalY + 5;
            const legendWidth = 30;
            const legendHeight = 8;
            const legendGap = 40;
            
            // Hadir
            doc.setFillColor(236, 253, 245);
            doc.setDrawColor(16, 185, 129);
            doc.roundedRect(14, legendY, legendWidth, legendHeight, 2, 2, 'FD');
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(16, 185, 129);
            doc.text('H = Hadir', 14 + legendWidth/2, legendY + legendHeight/2, { align: 'center', baseline: 'middle' });
            
            // Izin
            doc.setFillColor(254, 252, 232);
            doc.setDrawColor(202, 138, 4);
            doc.roundedRect(14 + legendGap, legendY, legendWidth, legendHeight, 2, 2, 'FD');
            doc.setTextColor(202, 138, 4);
            doc.text('I = Izin', 14 + legendGap + legendWidth/2, legendY + legendHeight/2, { align: 'center', baseline: 'middle' });
            
            // Sakit
            doc.setFillColor(239, 246, 255);
            doc.setDrawColor(37, 99, 235);
            doc.roundedRect(14 + legendGap*2, legendY, legendWidth, legendHeight, 2, 2, 'FD');
            doc.setTextColor(37, 99, 235);
            doc.text('S = Sakit', 14 + legendGap*2 + legendWidth/2, legendY + legendHeight/2, { align: 'center', baseline: 'middle' });
            
            // Alpha
            doc.setFillColor(254, 242, 242);
            doc.setDrawColor(220, 38, 38);
            doc.roundedRect(14 + legendGap*3, legendY, legendWidth, legendHeight, 2, 2, 'FD');
            doc.setTextColor(220, 38, 38);
            doc.text('A = Alpha', 14 + legendGap*3 + legendWidth/2, legendY + legendHeight/2, { align: 'center', baseline: 'middle' });
            
            // Reset warna teks
            doc.setTextColor(0, 0, 0);
            
            // Tambahkan footer
            doc.setFontSize(10);
            doc.setFont('helvetica', 'italic');
            doc.text('* Dokumen ini dicetak secara otomatis oleh Sistem Kehadiran Siswa Kelas 8B', doc.internal.pageSize.getWidth() / 2, legendY + legendHeight + 10, { align: 'center' });
            
            // Simpan file
            const fileName = `Rekap_Kehadiran_8B_${tanggalAwal}_${tanggalAkhir}.pdf`;
            doc.save(fileName);
        }
        
        // Helper function untuk mendapatkan rentang tanggal
        function getTanggalRange(start, end) {
            const result = [];
            const startDate = new Date(start);
            const endDate = new Date(end);
            
            let currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                result.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return result;
        }
        
        // Load data saat halaman dimuat
        window.addEventListener('DOMContentLoaded', function() {
            loadTabelSiswa();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963b6195a19c6023',t:'MTc1MzI3NTg0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
